import requests, json
'''
    Let me show you how to request to VATEX_NOVA_AI-API_Server !
'''

# ip/port
API_SERVER_IP = "192.168.1.205"
API_SERVER_PORT = 10302

# path
Deep_Learning_Train_Path = "/api/solution/util/nova/DL/train"
Deep_Learning_Prediction_Path = "/api/solution/util/nova/DL/predict"
Machine_Learning_Train_Path = "/api/solution/util/nova/ML/train"
Machine_Learning_Prediction_Path = "/api/solution/util/nova/ML/predict"

#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#
# Deep Learning
#
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################

# Scenario 1. Classification
Scenario_1_Train_Req = \
"""
{
  "id": "classification-model-01",
  "data": {
      "X": {
          "source": [
              [10, 20, 30], [11, 22, 33], [90, 80, 70], [95, 88, 77],
              [50, 50, 50], [45, 55, 60], [12, 25, 35], [92, 81, 74]
          ]
      },
      "y": {
          "source": [
            "A", "B", "C", "B", 
            "C", "A", "C", "B"
          ],
          "y_type": "one_hot_encode"
      }
  },
  "train": {
      "layer": {
          "input": { "shape": [3] },
          "hiddens": [
              { "type": "dense", "units": 16, "activation_func": "relu" }
          ],
          "output": { "units": 3, "activation_func": "softmax" }
      },
      "compile": {
          "optimizer_func": "adam",
          "loss_func": "categorical_crossentropy",
          "metrics": ["accuracy"]
      },
      "fit": {
          "epochs": 10,
          "batch_size": 1,
          "validation_split": 0.25
      }
  }
}
"""
Scenario_1_Prediction_Req = \
"""
{
    "id": "classification-model-01",
    "data": {
        "X": {
            "source": [
                [11, 22, 33]
            ]
        }
    }
}
"""

# request for training
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Deep_Learning_Train_Path, data=json.dumps(Scenario_1_Train_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":[{"accuracy":0.3333333432674408,"loss":1.0891636610031128,"val_accuracy":0.5,"val_loss":0.9032398462295532},
    {"accuracy":0.3333333432674408,"loss":1.082886815071106,"val_accuracy":0.5,"val_loss":0.9078031778335571},{"accuracy":0.5,"loss":1.0796005725860596,
    "val_accuracy":0.5,"val_loss":0.9137726426124573},{"accuracy":0.5,"loss":1.0730088949203491,"val_accuracy":0.5,"val_loss":0.9171659350395203},
    {"accuracy":0.5,"loss":1.071439266204834,"val_accuracy":0.5,"val_loss":0.9234049916267395},{"accuracy":0.5,"loss":1.0683495998382568,"val_accuracy":0.5,"val_loss":0.9279903173446655},
    {"accuracy":0.5,"loss":1.0659137964248657,"val_accuracy":0.5,"val_loss":0.9341307878494263},{"accuracy":0.5,"loss":1.0645748376846313,"val_accuracy":0.5,"val_loss":0.9388964176177979},
    {"accuracy":0.5,"loss":1.0608512163162231,"val_accuracy":0.5,"val_loss":0.9400978684425354},{"accuracy":0.5,"loss":1.059830904006958,"val_accuracy":0.5,"val_loss":0.94476318359375}]}'
'''

# lets go prediction
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Deep_Learning_Prediction_Path, data=json.dumps(Scenario_1_Prediction_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":{"argmax":{"B":0.33860063552856445},"argmin":{"A":0.32945770025253296},"all":{"A":0.32945770025253296,"B":0.33860063552856445,"C":0.3319416642189026}}}'
'''

# Scenario 2. Regression
Scenario_2_Train_Req = \
"""
{
  "id": "regression-model-01",
  "data": {
      "X": {
          "source": [
              [10, 20, 30], [11, 22, 33], [90, 80, 70], [95, 88, 77],
              [50, 50, 50], [45, 55, 60], [12, 25, 35], [92, 81, 74]
          ]
      },
      "y": {
          "source": [
            1.0, 2.0, 3.0, 2.0, 
            3.0, 1.0, 3.0, 2.0
          ],
          "y_type": "min_max"
      }
  },
  "train": {
      "layer": {
          "input": { "shape": [3] },
          "hiddens": [
              { "type": "dense", "units": 16, "activation_func": "relu" }
          ],
          "output": { "units": 1, "activation_func": "sigmoid" }
      },
      "compile": {
          "optimizer_func": "adam",
          "loss_func": "mse",
          "metrics": ["mae"]
      },
      "fit": {
          "epochs": 10,
          "batch_size": 1,
          "validation_split": 0.25
      }
  }
}
"""
Scenario_2_Prediction_Req = \
"""
{
    "id": "regression-model-01",
    "data": {
        "X": {
            "source": [
                [11, 22, 33]
            ]
        }
    }
}
"""

# request for training
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Deep_Learning_Train_Path, data=json.dumps(Scenario_2_Train_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":[{"loss":0.2034807652235031,"mae":0.38669994473457336,"val_loss":0.13519415259361267,"val_mae":0.3201397657394409},
    {"loss":0.20247896015644073,"mae":0.38515543937683105,"val_loss":0.13282975554466248,"val_mae":0.3143080770969391},{"loss":0.19911877810955048,"mae":0.3818736970424652,"val_loss":0.13186243176460266,"val_mae":0.31142961978912354},
    {"loss":0.19738054275512695,"mae":0.3797112703323364,"val_loss":0.13083718717098236,"val_mae":0.3083692789077759},{"loss":0.1965617686510086,"mae":0.37793681025505066,"val_loss":0.12936006486415863,"val_mae":0.3037474751472473},
    {"loss":0.1942306011915207,"mae":0.37527528405189514,"val_loss":0.1283135712146759,"val_mae":0.3002127707004547},{"loss":0.19252027571201324,"mae":0.37375426292419434,"val_loss":0.12748567759990692,"val_mae":0.2971586585044861},
    {"loss":0.19245988130569458,"mae":0.37284767627716064,"val_loss":0.1261535882949829,"val_mae":0.292408287525177},{"loss":0.18991237878799438,"mae":0.3695094585418701,"val_loss":0.12552990019321442,"val_mae":0.2895107865333557},
    {"loss":0.18892443180084229,"mae":0.36837849020957947,"val_loss":0.12481993436813354,"val_mae":0.28631043434143066}]}'
'''

# lets go prediction
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Deep_Learning_Prediction_Path, data=json.dumps(Scenario_2_Prediction_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":{"output":2.010890245437622}}' # output: predicted value
'''


#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#
# Machine Learning
#
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################
#######################################################################################################################################################################################################################################

# Scenario 1. Classification - RandomForest
Scenario_1_Train_Req = \
"""
{
    "id": "MyML-01",
    "data": {
        "X": {
            "source": [
                [10, 15, 20], [12, 18, 25], [9, 14, 19], [11, 17, 23],
                [50, 55, 60], [53, 58, 63], [47, 52, 57], [55, 60, 65],
                [90, 85, 80], [88, 82, 78], [92, 87, 83], [95, 89, 84]
            ]
        },
        "y": {
            "source": [
                "A", "A", "A", "A",
                "B", "B", "B", "B",
                "C", "C", "C", "C"
            ],
            "y_type": "label"
        }
    },
    "train": {
        "model": {
            "model_name": "RandomForestClassifier",
            "model_params": {
                "n_estimators": 100,
                "random_state": 4
            }
        },
        "trainset": {
            "test_size": 0.25,
            "shuffle": true,
            "stratify": "y"
        }
    }
}

"""

# request for training
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Machine_Learning_Train_Path, data=json.dumps(Scenario_1_Train_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":1.0}'
    
    "output" -> accuracy-value in classification-models
'''

# lets go prediction
Scenario_1_Prediction_Req = \
"""
{
    "id": "MyML-01",
    "data": {
        "X": {
            "source": [
                [10, 15, 20]
            ]
        }
    }
}
"""
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Machine_Learning_Prediction_Path, data=json.dumps(Scenario_1_Prediction_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":{
            "argmax":{"A":0.98},                # -> Max
            "argmin":{"C":0.0},                 # -> Min
            "all":{"A":0.98,"B":0.02,"C":0.0}   # -> All- outputs
        }
    }'
'''



# Scenario 2. Regression - LinearRegression
Scenario_2_Train_Req = \
"""
{
    "id": "Regression-01",
    "data": {
        "X": {"source": [[1], [2], [3], [4]]},
        "y": {"source": [2.0, 4.1, 6.0, 8.2], "y_type": "raw"}
    },
    "train": {
        "model": {
            "model_name": "LinearRegression"
        },
        "trainset": {"test_size": 0.25, "shuffle": true}
    }
}
"""

# request for training
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Machine_Learning_Train_Path, data=json.dumps(Scenario_2_Train_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":0.0}'
    
    * The smaller the output value, the smaller the error.
    < output -> MSE value >
    0.0 is best!
    1.0 is poor!
    
    "output" -> accuracy-value in classification-models
'''

# lets go prediction
Scenario_2_Prediction_Req = \
"""
{
    "id": "Regression-01",
    "data": {"X": {"source": [[5]]}}
}
"""
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Machine_Learning_Prediction_Path, data=json.dumps(Scenario_2_Prediction_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":{
            "predicted_values":[10.199999999999998],    # predict values
            "mean":10.199999999999998,                  
            "std":0.0                                   # (표준편차) -> standard deviation * if one sample, 0.0 
        }
    }'
'''


# Scenario 3. Clustering - KMeans
Scenario_3_Train_Req = \
"""
{
    "id": "Clustering-01",
    "data": {"X": {"source": [[1, 2], [1, 4], [5, 6], [6, 5]]}},
    "train": {
        "model": {
            "model_name": "KMeans",
            "model_params": {"n_clusters": 2, "random_state": 42}
        }
    }
}
"""

# request for training
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Machine_Learning_Train_Path, data=json.dumps(Scenario_3_Train_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":0.591051482474553}'
    
    * output is accuracy
    
'''

# lets go prediction
Scenario_3_Prediction_Req = \
"""
{
    "id": "Clustering-01",
    "data": {"X": {"source": [[2, 3], [5, 5]]}}
}
"""
print( requests.post( "http://"+API_SERVER_IP+":"+str(API_SERVER_PORT)+Machine_Learning_Prediction_Path, data=json.dumps(Scenario_3_Prediction_Req)).content )
'''
    would be outputing this
    ->
    
    b'{"status":true,"output":{
            "clusters":[0,1],                  
            "unique_labels":[0,1],              
            "cluster_counts":{"0":1,"1":1}
        }
    }'
    
    *
    clusters → each point’s group
    unique_labels → all groups
    cluster_counts → how many in each group
    
'''